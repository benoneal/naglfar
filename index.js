Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("react-redux"),r=require("route-parser"),n=require("qs");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=a(t),u=a(r),c=a(n);var i,s,f=Object.keys,l=Object.values,p={},v={},d=function(t){return"string"==typeof t},h=function(t,e){void 0===e&&(e="MATCHED_ROUTE_WITH_NO_ACTIONS"),v[t]||(v[t]={pattern:new u.default(t),actions:Array.isArray(e)?e:[e]})},m=function(t){return l(v).reduce((function(e,r){var n=r.pattern,a=r.actions,o=n.match(t);return o?e.concat(a.map((function(t){return{params:o,action:t}}))):e}),[])},y=function(t,e){return new Promise((function(r){var n=E(t),a=n.status,o=n.matches,u=n.url;if(200!==a)return r({status:a,url:u});Promise.all(o.map((function(t){var r=t.params,n=t.action;return"function"==typeof n?e(n(r)):"object"==typeof n&&n.type?e(Object.assign({},n,{params:r})):"string"==typeof n?e({type:n,payload:r}):void 0})).filter((function(t){return t instanceof Promise}))).then((function(t){return r({status:a})}),(function(t){return r({status:500})}))}))},E=function(t){t=function(t){return void 0===t&&(t=""),"/"!==t&&"/"===t.slice(-1)?t.slice(0,-1):t}(t);var e=p[t],r=m(t);return{status:e?302:m(t).length?200:404,matches:r,url:e}},b=function(t){var e=E(t.pathname+t.search),r=e.status,n=e.matches;return Object.assign({},t,{status:t.status||r,params:n.reduce((function(t,e){var r=e.params;return Object.assign({},t,r)}),{}),query:c.default.parse(t.search.split("?")[1]||"")})},g=function(t,e){return function(r){e(O(r)),t(r)}},O=function(t){return{type:"ENTERING_ROUTE",payload:t}};var x=function(t){return t.location.status},j=function(t){var e=t.location;return e.pathname+e.search},R=function(t){var r=t.forRoute,n=t.beforeEnter,a=t.Element;void 0===a&&(a=o.default.Fragment);var u=t.children,c=e.useSelector(x),i=e.useSelector(j);return d(r)&&h(r,n),Boolean(r===c||200===c&&function(t,e){return v[t]&&v[t].pattern.match(e)}(r,i))&&o.default.createElement(a,{key:r},u)},N=function(t,e){return function(t){return Boolean(t.shiftKey||t.altKey||t.metaKey||t.ctrlKey)}(t)||function(t){return!!t.button}(t)||t.defaultPrevented||e},T=function(t){return t.location.search},_=function(t){return t.location.pathname},C=t.forwardRef((function(r,n){var a=r.to,u=r.target,c=r.prefetchData;void 0===c&&(c=!1);var f=r.persistQuery;void 0===f&&(f=!0);var l=r.replaceLocation;void 0===l&&(l=!1);var p=r.className;void 0===p&&(p="");var v=r.activeClassName;void 0===v&&(v="");var d=r.onClick;void 0===d&&(d=function(){});var h=r.children,m=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(r[n]=t[n]);return r}(r,["to","target","prefetchData","persistQuery","replaceLocation","className","activeClassName","onClick","children"]),E=e.useSelector(T),b=e.useSelector(_),g=e.useSelector((function(t){return t})),O=""+a+(f?E:"");t.useEffect((function(){c&&function(t,e){y(t,(function(t){return t((function(t){return t}),(function(){return e}))}))}(O,g)}),[]);var x=[p,a===b&&v].filter(Boolean).join(" ");return o.default.createElement("a",Object.assign({},{ref:n},m,{className:x,href:a,target:u,onClick:function(t){d(t),N(t,u)||(t.preventDefault(),l?s(O):i(O))}}),h)}));exports.Fragment=R,exports.Link=C,exports.buildLocationState=b,exports.default=function(t,e){return void 0===e&&(e=!1),function(r){var n,a=t.push.bind(t),o=t.replace.bind(t);t.push=g(a,r.dispatch),t.replace=g(o,r.dispatch),i=t.push,s=t.replace,t.listen((n=r.dispatch,function(t){var e=t.location||t;return y(e.pathname+e.search,n).then((function(t){var r=t.status,a=t.url;return a?s(a):n({type:"ENTERED_ROUTE",payload:Object.assign({},e,{status:r,url:a})})}))}));var u=e;return function(e){return function(n){e(n),u||(u=!0,y(t.location.pathname+t.location.search,r.dispatch))}}}},exports.navigateTo=function(t){return i(t)},exports.reducer=function(t,e){void 0===t&&(t={});var r=e.type,n=e.payload;return"ENTERED_ROUTE"===r?Object.assign({},t,{location:b(n)}):t},exports.registerRedirect=function(t,e){return p[t]=e},exports.registerRoute=h,exports.resolveLocation=y,exports.routeFragment=function(t,e,r){return d(t)&&h(t,e),function(n){var a=n.children;return o.default.createElement(R,{forRoute:t,beforeEnter:e,Element:r},a)}},exports.whitelist=function(){return[...f(p),...f(v)]};
