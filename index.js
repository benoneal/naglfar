Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("react-redux"),r=require("route-parser"),n=require("qs");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=a(t),i=a(r),u=a(n);var c,s,f=Object.keys,l=Object.values,p={},d={},v=function(t){return"string"==typeof t},h=function(t,e){void 0===e&&(e="MATCHED_ROUTE_WITH_NO_ACTIONS"),d[t]||(d[t]={pattern:new i.default(t),actions:Array.isArray(e)?e:[e]})},m=function(t,e){return new Promise((function(r){var n=y(t),a=n.status,o=n.matches,i=n.url;if(200!==a)return r({status:a,url:i});Promise.all(o.map((function(t){var r=t.params,n=t.action;return"function"==typeof n?e(n(r)):"object"==typeof n&&n.type?e(Object.assign({},n,{params:r})):"string"==typeof n?e({type:n,payload:r}):void 0})).filter((function(t){return t instanceof Promise}))).then((function(t){return r({status:a})}),(function(t){return r({status:500})}))}))},y=function(t){t=function(t){return void 0===t&&(t=""),"/"!==t&&"/"===t.slice(-1)?t.slice(0,-1):t}(t);var e=p[t],r=function(t){return l(d).reduce((function(e,r){var n=r.pattern,a=r.actions,o=n.match(t);return o?e.concat(a.map((function(t){return{params:o,action:t}}))):e}),[])}(t);return{status:e?302:r.length?200:404,matches:r,url:e}},E=function(t){var e=y(t.pathname+t.search),r=e.status,n=e.matches;return Object.assign({},t,{status:t.status||r,params:n.reduce((function(t,e){var r=e.params;return Object.assign({},t,r)}),{}),query:u.default.parse(t.search.split("?")[1]||"")})},O=function(t,e){return function(r){e(b(r)),t(r)}},b=function(t){return{type:"ENTERING_ROUTE",payload:t}},g=function(t){return function(e){var r=e.location||e;return m(r.pathname+r.search,t).then((function(e){var n,a=e.status,o=e.url;return o?s(o):t((n=Object.assign({},r,{status:a,url:o}),{type:"ENTERED_ROUTE",payload:Object.assign({},n,{initialised:!0})}))}))}};var j=function(t){return t.location.status},R=function(t){var e=t.location;return e.initialised?e.pathname+e.search:""},T=function(t){var r=t.forRoute,n=t.beforeEnter,a=t.Element;void 0===a&&(a=o.default.Fragment);var i=t.children,u=e.useSelector(j),c=e.useSelector(R);return v(r)&&h(r,n),Boolean(r===u||200===u&&function(t,e){return d[t]&&d[t].pattern.match(e)}(r,c))&&o.default.createElement(a,{key:r},i)},x=function(t,e){return function(t){return Boolean(t.shiftKey||t.altKey||t.metaKey||t.ctrlKey)}(t)||function(t){return!!t.button}(t)||t.defaultPrevented||e},N=function(t){return t.location.search},I=function(t){var e=t.location;return e.initialised?e.pathname:""},_=t.forwardRef((function(r,n){var a=r.to,i=r.target,u=r.prefetchData;void 0===u&&(u=!1);var f=r.persistQuery;void 0===f&&(f=!0);var l=r.replaceLocation;void 0===l&&(l=!1);var p=r.className;void 0===p&&(p="");var d=r.activeClassName;void 0===d&&(d="");var v=r.onClick;void 0===v&&(v=function(){});var h=r.children,y=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(r[n]=t[n]);return r}(r,["to","target","prefetchData","persistQuery","replaceLocation","className","activeClassName","onClick","children"]),E=e.useSelector(N),O=e.useSelector(I),b=e.useSelector((function(t){return t})),g=""+a+(f?E:"");t.useEffect((function(){u&&function(t,e){m(t,(function(t){return t((function(t){return t}),(function(){return e}))}))}(g,b)}),[]);var j=[p,a===O&&d].filter(Boolean).join(" ");return o.default.createElement("a",Object.assign({},{ref:n},y,{className:j,href:a,target:i,onClick:function(t){v(t),x(t,i)||(t.preventDefault(),l?s(g):c(g))}}),h)}));exports.Fragment=T,exports.Link=_,exports.buildLocationState=E,exports.default=function(t,e){return void 0===e&&(e=!1),function(r){var n=t.push.bind(t),a=t.replace.bind(t);t.push=O(n,r.dispatch),t.replace=O(a,r.dispatch),c=t.push,s=t.replace,t.listen(g(r.dispatch));var o=e;return function(e){return function(n){e(n),o||(o=!0,m(t.location.pathname+t.location.search,r.dispatch).then((function(){return r.dispatch({type:"INITIALISED_ROUTER"})})))}}}},exports.navigateTo=function(t){return c(t)},exports.reducer=function(t,e){void 0===t&&(t={});var r=e.type,n=e.payload;return"INITIALISED_ROUTER"===r?Object.assign({},t,{location:Object.assign({},t.location,{initialised:!0})}):"ENTERED_ROUTE"===r?Object.assign({},t,{location:E(n)}):t},exports.registerRedirect=function(t,e){return p[t]=e},exports.registerRoute=h,exports.resolveLocation=m,exports.routeFragment=function(t,e,r){return v(t)&&h(t,e),function(n){var a=n.children;return o.default.createElement(T,{forRoute:t,beforeEnter:e,Element:r},a)}},exports.whitelist=function(){return[...f(p),...f(d)]};
