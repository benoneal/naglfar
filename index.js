Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("react-redux"),n=require("route-parser"),r=require("qs");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=a(t),i=a(n),u=a(r);function c(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&-1===e.indexOf(r)&&(n[r]=t[r]);return n}var s,f,l=Object.keys,p=Object.values,d={},v={},h=function(t){return"string"==typeof t},m=function(t,e){void 0===e&&(e="MATCHED_ROUTE_WITH_NO_ACTIONS"),v[t]||(v[t]={pattern:new i.default(t),actions:Array.isArray(e)?e:[e]})},y=function(t,e){return new Promise((function(n){var r=E(t),a=r.status,o=r.matches,i=r.url;if(200!==a)return n({status:a,url:i});Promise.all(o.map((function(t){var n=t.params,r=t.action;return"function"==typeof r?e(r(n)):"object"==typeof r&&r.type?e(Object.assign({},r,{params:n})):"string"==typeof r?e({type:r,payload:n}):void 0})).filter((function(t){return t instanceof Promise}))).then((function(t){return n({status:a})}),(function(t){return n({status:500})}))}))},E=function(t){t=function(t){return void 0===t&&(t=""),"/"!==t&&"/"===t.slice(-1)?t.slice(0,-1):t}(t);var e=d[t],n=function(t){return p(v).reduce((function(e,n){var r=n.pattern,a=n.actions,o=r.match(t);return o?e.concat(a.map((function(t){return{params:o,action:t}}))):e}),[])}(t);return{status:e?302:n.length?200:404,matches:n,url:e}},O=function(t,e){void 0===e&&(e={});var n=c(e,["entering"]),r=E(t.pathname+t.search),a=r.status,o=r.matches;return Object.assign({},n,t,{status:t.status||a,params:o.reduce((function(t,e){var n=e.params;return Object.assign({},t,n)}),{}),query:u.default.parse(t.search.split("?")[1]||"")})},g=function(t,e){return function(n){e(b(n)),t(n)}},b=function(t){return{type:"ENTERING_ROUTE",payload:t}};var R=function(t){return t.location.status},j=function(t){var e=t.location;return e.initialised?e.pathname+e.search:""},T=function(t){var n=t.forRoute,r=t.beforeEnter,a=t.Element;void 0===a&&(a=o.default.Fragment);var i=t.children,u=e.useSelector(R),c=e.useSelector(j);return h(n)&&m(n,r),Boolean(n===u||200===u&&function(t,e){return v[t]&&v[t].pattern.match(e)}(n,c))&&o.default.createElement(a,{key:n},i)},N=function(t,e){return function(t){return Boolean(t.shiftKey||t.altKey||t.metaKey||t.ctrlKey)}(t)||function(t){return!!t.button}(t)||t.defaultPrevented||e},x=function(t){return t.location.search},I=function(t){var e=t.location;return e.initialised?e.pathname:""},_=t.forwardRef((function(n,r){var a=n.to,i=n.target,u=n.prefetchData;void 0===u&&(u=!1);var l=n.persistQuery;void 0===l&&(l=!0);var p=n.replaceLocation;void 0===p&&(p=!1);var d=n.className;void 0===d&&(d="");var v=n.activeClassName;void 0===v&&(v="");var h=n.onClick;void 0===h&&(h=function(){});var m=n.children,E=c(n,["to","target","prefetchData","persistQuery","replaceLocation","className","activeClassName","onClick","children"]),O=e.useSelector(x),g=e.useSelector(I),b=e.useSelector((function(t){return t})),R=""+a+(l?O:"");t.useEffect((function(){u&&function(t,e){y(t,(function(t){return t((function(t){return t}),(function(){return e}))}))}(R,b)}),[]);var j=[d,a===g&&v].filter(Boolean).join(" ");return o.default.createElement("a",Object.assign({},{ref:r},E,{className:j,href:a,target:i,onClick:function(t){h(t),N(t,i)||(t.preventDefault(),p?f(R):s(R))}}),m)}));exports.Fragment=T,exports.Link=_,exports.buildLocationState=O,exports.default=function(t,e){return void 0===e&&(e=!1),function(n){var r,a=t.push.bind(t),o=t.replace.bind(t);t.push=g(a,n.dispatch),t.replace=g(o,n.dispatch),s=t.push,f=t.replace,t.listen((r=n.dispatch,function(t){var e=t.location||t;return y(e.pathname+e.search,r).then((function(t){var n=t.status,a=t.url;return a?f(a):r({type:"ENTERED_ROUTE",payload:Object.assign({},e,{status:n,url:a})})}))}));var i=e;return function(e){return function(r){e(r),i||(i=!0,y(t.location.pathname+t.location.search,n.dispatch).then((function(){return n.dispatch({type:"INITIALISED_ROUTER"})})))}}}},exports.navigateTo=function(t){return s(t)},exports.reducer=function(t,e){void 0===t&&(t={});var n=e.type,r=e.payload;return"INITIALISED_ROUTER"===n?Object.assign({},t,{location:Object.assign({},t.location,{initialised:!0})}):"ENTERED_ROUTE"===n?Object.assign({},t,{location:O(r,t.location)}):"ENTERING_ROUTE"===n?Object.assign({},t,{location:Object.assign({},t.location,{entering:r})}):t},exports.registerRedirect=function(t,e){return d[t]=e},exports.registerRoute=m,exports.resolveLocation=y,exports.routeFragment=function(t,e,n){return h(t)&&m(t,e),function(r){var a=r.children;return o.default.createElement(T,{forRoute:t,beforeEnter:e,Element:n},a)}},exports.whitelist=function(){return[...l(d),...l(v)]};
